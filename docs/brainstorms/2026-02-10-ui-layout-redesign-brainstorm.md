# UI画面構成の改善

**Date:** 2026-02-10
**Status:** Brainstorm

## What We're Building

bantoのUI画面構成を、実際のUXに合った配置に改善する。主な変更は以下の3点:

1. **3カラムレイアウト**: 左=タスク一覧、中央=タスク情報+AgentのTodo、右=チャット風セッションビュー
2. **タスク=セッションの統合**: 1タスク=1セッション。セッション履歴の概念をUIから排除し、タスクが会話の単位になる
3. **マルチターン会話**: agentへの追加指示・確認応答をチャット風UIでシームレスに行える

## Why This Approach

### 課題の整理

- **タスクとセッションの概念重複**: 1タスクで同時実行できるセッションは1つなのに、複数セッションを操作できそうなUIになっていて紛らわしい
- **タスク作成の摩擦**: ヘッダーのドロップダウンが小さく、メモ→投入がスムーズでない
- **セッション対話の不在**: agentへの追加指示や確認応答がUIから行えない
- **情報配置の非効率**: タスク詳細にセッション履歴が混在し、今見たい情報にたどり着きにくい

### 3カラム（タスク一覧 | タスク情報+Todo | チャットセッション）を選んだ理由

- bantoのコア操作「メモして、投げて、見る」を1画面で完結させる
- タスク情報とAgentのTodoを中央に置くことで、agentの進捗と計画が常に見える
- チャット風セッションビューを独立カラムにすることで、マルチターン会話に十分な領域を確保

### 1タスク=1セッションにする理由

- 概念のシンプル化: ユーザーが操作する単位が「タスク」のみになる
- セッション履歴はDB上には残すが、UIでは見せない
- やり直しは「追加指示で修正」or「再実行（履歴は裏で管理）」

## Key Decisions

| # | 決定事項 | 選択 | 理由 |
|---|---------|------|------|
| 1 | レイアウト構成 | 3カラム（一覧 / 情報+Todo / チャット） | 全情報を1画面で把握、操作できる |
| 2 | タスクとセッションの関係 | 1タスク=1セッション（UIレベル） | 概念の重複を排除、シンプル化 |
| 3 | セッション履歴 | DBに残すがUIでは非表示 | データは保持しつつUXを簡素化 |
| 4 | タスク作成UI | モーダルダイアログ（プロジェクト選択+タイトル+説明） | ドロップダウンより入力しやすい |
| 5 | マルチターン会話 | チャット風入力欄で追加指示+確認応答 | agentとの対話がメイン操作になる |
| 6 | AgentのTodo表示 | 中央パネルにTodoWriteの結果を表示 | agentの計画・進捗が常に見える |
| 7 | モバイル対応 | 後回し | まずデスクトップの3カラムに集中 |
| 8 | TanStack Router導入 | 後回し | 3カラム化は現行のstate管理で実装可能。ルーティングは別課題 |
| 9 | タスク一覧の構成 | 現行維持（Pinned / Active / Backlog） | 既に機能しており変更不要 |

## 画面構成イメージ

```
+------------------+------------------------+---------------------------+
| タスク一覧        | タスク情報              | セッション                  |
|                  |                        |                           |
| [+ タスク追加]    | タイトル: xxx           | [agent] テスト書きます       |
|                  | ステータス: running     | [agent] ファイルを読みます    |
| --- Pinned ---   | プロジェクト: banto     | [tool] Read src/foo.ts     |
| * タスクA        | 説明:                  | [agent] 実装しました         |
|                  |   ここにメモが入る      |                           |
| --- Active ---   |                        | [確認待ち]                   |
|  banto           | --- Agent Todo ---     |  この変更でよいですか？       |
|  * タスクB ●     | [x] テスト作成          |  [承認] [却下]              |
|  * タスクC ●     | [ ] 実装               |                           |
|                  | [ ] リファクタ          | +---------------------------+
| --- Backlog ---  |                        | | 追加指示を入力...    [送信] |
|  project-x       |                        | +---------------------------+
|  * タスクD       |                        |                           |
+------------------+------------------------+---------------------------+
```

## Open Questions

- **バックエンド影響**: マルチターン会話（agentへのメッセージ送信API）とTodo表示（Agent SDKのTodoWriteイベントのリアルタイム取得・ストリーミング）はUI変更だけでは完結しない。API/WebSocket側の変更が必要。planフェーズでスコープに含めること
- **確認応答のUI**: agentが確認を求めたとき、チャット内にインラインでボタンを表示するか、別UIにするか
- **再実行の挙動**: 再実行時に既存の会話はどうなるか（クリアして新規開始？裏でアーカイブ？）。データモデルに影響する
- **空状態**: タスク未選択時の中央パネル・右パネルに何を表示するか
